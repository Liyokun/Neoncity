<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üåÉ Cyberpunk Debug</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: monospace; }
        #joystick-zone { position: absolute; bottom: 50px; left: 50px; width: 120px; height: 120px; z-index: 100; }
        #loading { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; display: flex; align-items: center; justify-content: center;
            z-index: 999; color: #00f2ff; flex-direction: column;
        }
        #btn-start { 
            padding: 15px 30px; background: #00f2ff; color: #000; 
            border: none; cursor: pointer; font-weight: bold; margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h1 id="status">‚ö° INITIALIZING...</h1>
        <button id="btn-start" style="display:none">V√ÄO TH·∫æ GI·ªöI (C∆Ø·ª†NG B·ª®C)</button>
    </div>
    <div id="joystick-zone"></div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js"></script>

    <script type="module">
        import * as THREE from 'three';
        import { GroundedSkybox } from 'https://unpkg.com/three@0.160.0/examples/jsm/objects/GroundedSkybox.js';

        const loadingScreen = document.getElementById('loading');
        const statusH1 = document.getElementById('status');
        const startBtn = document.getElementById('btn-start');

        // Hi·ªÉn th·ªã n√∫t v√†o game sau 2 gi√¢y d√π ·∫£nh c√≥ t·∫£i ƒë∆∞·ª£c hay kh√¥ng
        setTimeout(() => { startBtn.style.display = 'block'; statusH1.innerText = "READY (IMAGES MAY FAIL)"; }, 2000);
        startBtn.onclick = () => loadingScreen.style.display = 'none';

        // 1. SETUP
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 0);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 2. LOAD ·∫¢NH (B·ªçc trong Try-Catch ƒë·ªÉ tr√°nh ƒë·ª©ng h√¨nh to√†n b·ªô code)
        const loader = new THREE.CubeTextureLoader();
        loader.setCrossOrigin('anonymous');
        
        let texture;
        try {
            texture = loader.load([
                'https://liyokun.github.io/Neoncity/px.png', 'https://liyokun.github.io/Neoncity/nx.png',
                'https://liyokun.github.io/Neoncity/py.png', 'https://liyokun.github.io/Neoncity/ny.png',
                'https://liyokun.github.io/Neoncity/pz.png', 'https://liyokun.github.io/Neoncity/nz.png'
            ], 
            () => { console.log("Success"); loadingScreen.style.display = 'none'; },
            undefined,
            (err) => { console.error("·∫¢nh l·ªói nh∆∞ng code v·∫´n ch·∫°y ti·∫øp"); }
            );
        } catch(e) { console.error("L·ªói loader"); }

        // 3. GROUNDED SKYBOX
        const skybox = new GroundedSkybox(texture, 15, 70);
        scene.add(skybox);

        // 4. C√ÅC TH√ÄNH PH·∫¶N KH√ÅC (ƒê√®n, M∆∞a, S√†n)
        scene.add(new THREE.AmbientLight(0xffffff, 0.3));
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100,100), new THREE.MeshStandardMaterial({color: 0x111111}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        // (Gi·ªØ nguy√™n ph·∫ßn ƒë√®n v√† joystick c·ªßa b·∫°n ph√≠a d∆∞·ªõi...)
        // ... ANIMATION LOOP ...
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
